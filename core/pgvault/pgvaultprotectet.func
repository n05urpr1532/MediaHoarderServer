#!/usr/bin/env bash

runningcheck() {
  initial2
  runcheck5=$(docker ps | grep ${program_var})
  if [ "$runcheck5" != "" ]; then running=1; else running=0; fi
}

initial() {
  rm -rf /var/mhs/state/pgvault.output 1> /dev/null 2>&1
  rm -rf /var/mhs/state/pgvault.buildup 1> /dev/null 2>&1
  rm -rf /var/mhs/state/program.temp 1> /dev/null 2>&1
  rm -rf /var/mhs/state/app.list 1> /dev/null 2>&1
  rm -rf /var/mhs/state/pgvault.output 1> /dev/null 2>&1
  touch /var/mhs/state/pgvault.output
  touch /var/mhs/state/program.temp
  touch /var/mhs/state/app.list
  touch /var/mhs/state/pgvault.buildup
  touch /var/mhs/state/pgvault.output
  touch /var/mhs/state/rclone.size
  space=$(cat /var/mhs/state/data.location)
  # To Get Used Space
  used=$(df -h /opt/mhs/etc/mhs | tail -n +2 | awk '{print $3}')
  # To Get All Space
  capacity=$(df -h /opt/mhs/etc/mhs | tail -n +2 | awk '{print $2}')
  # Percentage
  percentage=$(df -h /opt/mhs/etc/mhs | tail -n +2 | awk '{print $5}')
}

initial2() {
  path=$(cat /var/mhs/state/server.hd.path)
  tarlocation=$(cat /var/mhs/state/data.location)
  program_size=$(cat /var/mhs/state/rclone.size)
  program_var=$(cat /tmp/program_var)
  server_id=$(cat /var/mhs/state/server.id)
}

final() {
  echo
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  read -p 'âœ… Process Complete! | PRESS [ENTER] ' typed < /dev/tty
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  bash /opt/mhs/lib/backup-and-restore/pgvault.sh
  exit
}

queued() {
  echo
  read -p "â›”ï¸ ERROR - $typed Already Queued! | Press [ENTER] " typed < /dev/tty
}

badserver() {
  echo
  read -p 'â›”ï¸ ERROR - Type an Exact Server Name | Press [ENTER] ' typed < /dev/tty
}

#not used yet
rclonelist() {
  ls -l /mnt/gdrive/mhs/backup | grep "^d" | awk '{print $9}' > pgvault.serverlist
}

pgboxrecall() {
  ls -p /opt/mhs/lib/apps-core | grep -v / > /var/mhs/state/pgvault.apprecall
  while read p; do
    sed -i "/^$p\b/Id" /var/mhs/state/pgvault.apprecall
  done < /opt/mhs/lib/backup-and-restore/exempt.list

  while read p; do
    sed -i "/^$p\b/Id" /var/mhs/state/pgvault.apprecall
    basename "$p" .yml >> /var/mhs/state/pgvault.apprecall
  done < /var/mhs/state/pgvault.apprecall
}

mathprime() {
  ### List Out Apps In Readable Order (One's Not Installed)
  num=0
  rm -rf /var/mhs/state/program.temp 1> /dev/null 2>&1
  while read p; do
    echo -n $p >> /var/mhs/state/program.temp
    echo -n " " >> /var/mhs/state/program.temp
    num=$((num + 1))
    if [ "$num" == 7 ]; then
      num=0
      echo " " >> /var/mhs/state/program.temp
    fi
  done < /var/mhs/state/pgvault.apprecall
}

################################################ FOR BACKUP - START
apprecall() {
  tree -d -L 1 /opt/mhs/apps-data | awk '{print $2}' | tail -n +2 | head -n -2 > /var/mhs/state/pgvault.apprecall
  while read p; do
    sed -i "/^$p\b/Id" /var/mhs/state/pgvault.apprecall
  done < /opt/mhs/lib/backup-and-restore/exempt.list

  ### Blank Out Temp List
  rm -rf /var/mhs/state/program.temp && touch /var/mhs/state/program.temp
  mathprime
}

buildup() {
  echo "$typed" >> /var/mhs/state/pgvault.buildup
  sed -i "/^$typed\b/Id" /var/mhs/state/pgvault.apprecall

  num=0
  rm -rf /var/mhs/state/pgvault.output 1> /dev/null 2>&1
  while read p; do
    echo -n $p >> /var/mhs/state/pgvault.output
    echo -n " " >> /var/mhs/state/pgvault.output
    if [ "$num" == 7 ]; then
      num=0
      echo " " >> /var/mhs/state/pgvault.output
    fi
  done < /var/mhs/state/pgvault.buildup

  mathprime
  vaultbackup
}
################################################ FOR BACKUP - END
serverprime() {
  tree -d -L 1 /mnt/gdrive/mhs/backup | awk '{print $2}' | tail -n +2 | head -n -2 > /tmp/server.list

  ### List Out Apps In Readable Order (One's Not Installed)
  num=0
  rm -rf /var/mhs/state/program.temp 1> /dev/null 2>&1
  while read p; do
    echo -n $p >> /var/mhs/state/program.temp
    echo -n " " >> /var/mhs/state/program.temp
    num=$((num + 1))
    if [ "$num" == 7 ]; then
      num=0
      echo " " >> /var/mhs/state/program.temp
    fi
  done < /tmp/server.list

  servers=$(cat /var/mhs/state/program.temp)
  server_id=$(cat /var/mhs/state/server.id)

  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ Backup & Restore ~ Server Recall  [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‚ Current [${server_id}] & Prior Servers Detected:

$servers

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[Z] Exit
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
  read -p 'ğŸŒ Type Server Name | Press [ENTER]: ' server < /dev/tty
  echo $server > /tmp/server.select

  if [[ "$server" == "exit" || "$server" == "Exit" || "$server" == "EXIT" || "$server" == "z" || "$server" == "Z" ]]; then exit; fi

  current2=$(cat /tmp/server.list | grep "\<$server\>")
  if [ "$current2" == "" ]; then
    badserver
    serverprime
  fi

  tempserver=$server
  ls -l /mnt/gdrive/mhs/backup/$tempserver/protected/ | awk '{print $9}' | tail -n +2 > /var/mhs/state/pgvault.restoreapps

  ### Blank Out Temp List
  rm -rf /var/mhs/state/pgvault.apprecall 1> /dev/null 2>&1
  touch /var/mhs/state/pgvault.apprecall

  while read p; do
    basename "$p" .tar >> /var/mhs/state/pgvault.apprecall
  done < /var/mhs/state/pgvault.restoreapps

  ### Blank Out Temp List
  rm -rf /var/mhs/state/program.temp 1> /dev/null 2>&1
  touch /var/mhs/state/program.temp
  mathprime
}

buildup2() {
  echo "$typed" >> /var/mhs/state/pgvault.buildup
  sed -i "/^$typed\b/Id" /var/mhs/state/pgvault.apprecall

  num=0
  rm -rf /var/mhs/state/pgvault.output 1> /dev/null 2>&1
  while read p; do
    echo -n $p >> /var/mhs/state/pgvault.output
    echo -n " " >> /var/mhs/state/pgvault.output
    if [ "$num" == 7 ]; then
      num=0
      echo " " >> /var/mhs/state/pgvault.output
    fi
  done < /var/mhs/state/pgvault.buildup

  mathprime
  vaultrestore
}
################################################ FOR RESTORE - START

################################################ FOR RESTORE - END

######################################################## START - PG Vault Backup

backup_all_start() {

  while read p; do
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Backing Up: $p
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

    sleep 2.5

    # Store Used Program
    echo $p > /tmp/program_var
    # Execute Main Program
    backup_process

    sleep 2
  done < /var/mhs/state/pgvault.apprecall
  final
}

backup_start() {
  while read p; do
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Backing Up: $p
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

    sleep 2.5

    # Store Used Program
    echo $p > /tmp/program_var
    # Execute Main Program
    backup_process

    sleep 2
  done < /var/mhs/state/pgvault.buildup
  final
}

backup_process() {
  initial2

  runningcheck
  if [ "$running" == "1" ]; then
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Stopping Docker Container - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
    sleep 1
    docker stop $program_var 1> /dev/null 2>&1
  fi

  ###### Start the Backup Process - Backup Locally First
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Zipping Data Locally - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

  path=$(cat /var/mhs/state/server.hd.path)
  tarlocation=$(cat /var/mhs/state/data.location)
  server_id=$(cat /var/mhs/state/server.id)

  tar \
  --warning=no-file-changed --ignore-failed-read --absolute-names --warning=no-file-removed \
  --exclude-from=/opt/mhs/lib/backup-and-restore/exclude.list \
  -czf - /opt/mhs/apps-data/${program_var} | openssl enc -e -aes256 -out /opt/mhs/etc/mhs/${program_var}.tar.gz ./

  ##### Restart Docker Application if was Running Prior
  if [ "$running" == "1" ]; then
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Restarting Docker Application - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
    sleep 2
    docker restart $program_var 1> /dev/null 2>&1
  fi

  ###### Backing Up Files to GDrive
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Sending Zipped Data to Google Drive - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

  # User specifying  VARS
  useragent="$(cat /var/mhs/state/uagent)"
  bwlimit="$(cat /var/mhs/state/blitz.bw)"

  vfs_dcs="$(cat /var/mhs/state/vfs_dcs)"
  vfs_mt="$(cat /var/mhs/state/vfs_mt)"
  vfs_t="$(cat /var/mhs/state/vfs_t)"
  vfs_c="$(cat /var/mhs/state/vfs_c)"

  rclone --config /opt/mhs/etc/rclone/rclone.conf mkdir gdrive:/mhs/backup/${server_id}/protected/ 1> /dev/null 2>&1

  rclone moveto ${tarlocation}/${program_var}.tar.gz \
  gdrive:/mhs/backup/${server_id}/protected/${program_var}.tar.gz \
  --config /opt/mhs/etc/rclone/rclone.conf \
  -v --checksum --stats-one-line --stats 1s --progress \
  --tpslimit=10 \
  --checkers="$vfs_c" \
  --transfers="$vfs_t" \
  --no-traverse \
  --fast-list \
  --bwlimit="$bwlimit" \
  --drive-chunk-size="$vfs_dcs" \
  --user-agent="$useragent"

  ##### Remove File Incase
  rm -rf ${tarlocation}/${program_var}.tar.gz 1> /dev/null 2>&1
}
######################################################## END - PG Vault Backup
#
##################################################### START - PG Vault Restore
restore_all_start() {

  while read p; do
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Restoring: $p
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

    sleep 2.5

    # Store Used Program
    echo $p > /tmp/program_var
    # Execute Main Program
    restore_process

    sleep 2
  done < /var/mhs/state/pgvault.apprecall
  final
}

restore_start() {

  while read p; do
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Restoring: $p
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

    sleep 2.5

    # Store Used Program
    echo $p > /tmp/program_var
    # Execute Main Program
    restore_process

    sleep 2
  done < /var/mhs/state/pgvault.buildup
  final
}

restore_process() {
  initial2
  srecall=$(cat /tmp/server.select)
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Determining Initial File Size - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
  size=$(du -sh --apparent-size /mnt/gdrive/mhs/backup/${srecall}/protected/${program_var}.tar.gz | /usr/bin/awk '{print $1}')
  sleep 2
  echo "Initial File Size: $size"
  sleep 2

  ###### Backing Up Files to GDrive
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Downloading Data From Google Drive - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
  # User specifying  VARS
  useragent="$(cat /var/mhs/state/uagent)"
  bwlimit="$(cat /var/mhs/state/blitz.bw)"

  vfs_dcs="$(cat /var/mhs/state/vfs_dcs)"
  vfs_mt="$(cat /var/mhs/state/vfs_mt)"
  vfs_t="$(cat /var/mhs/state/vfs_t)"
  vfs_c="$(cat /var/mhs/state/vfs_c)"

  rclone copy gdrive:/mhs/backup/${srecall}/protected/${program_var}.tar.gr ${tarlocation} \
  --config /opt/mhs/etc/rclone/rclone.conf \
  -v --checksum --stats-one-line --stats 1s --progress \
  --tpslimit=10 \
  --checkers="$vfs_c" \
  --transfers="$vfs_t" \
  --no-traverse \
  --fast-list \
  --bwlimit="$bwlimit" \
  --drive-chunk-size="$vfs_dcs" \
  --user-agent="$useragent"

  ##### Stop Docker Container if Running
  runningcheck
  if [ "$running" == "1" ]; then
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Stopping Docker Container - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
    sleep 1
    docker stop $program_var 1> /dev/null 2>&1
  fi

  ###### Start the Backup Process - Backup Locally First
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  UnZipping & Restoring Data - $program_var [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

  mkdir -p "/opt/mhs/apps-data/${program_var}"
  rm -rf "/opt/mhs/apps-data/${program_var}/*"
  chown -R 1000:1000 "/opt/mhs/apps-data/${program_var}"
  chmod -R 775 "/opt/mhs/apps-data/${program_var}"
  openssl enc -d -aes256 -in /opt/mhs/apps-data/${program_var} | tar xz -C ${tarlocation}/${program_var}.tar.gz
  chown -R 1000:1000 "/opt/mhs/apps-data/${program_var}"
  chmod -R 775 "/opt/mhs/apps-data/${program_var}"

  ##### Restart Docker Application if was Running Prior
  if [ "$running" == "1" ]; then
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â†˜ï¸  Restarting Docker Application - $program_var
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
    sleep 2
    docker restart $program_var 1> /dev/null 2>&1
  fi

  ##### Remove File Incase
  rm -rf ${tarlocation}/${program_var}.tar 1> /dev/null 2>&1
}
##################################################### END - PG Vault Restore
#
##################################################### START - Backup Interface
vaultbackup() {
  ### List Out Apps In Readable Order (One's Not Installed)
  notrun=$(cat /var/mhs/state/program.temp)
  buildup=$(cat /var/mhs/state/pgvault.output)

  if [ "$buildup" == "" ]; then buildup="NONE"; fi
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ Backup & Restore ~ Data Storage  [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‚ App Data available to Backup

$notrun

ğŸ’¾ Apps Queued for Backup

$buildup

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[A] Backup
[Z] Exit
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
  read -p 'ğŸŒ Type APP for QUEUE | Type all to backup all apps | Press [ENTER]: ' typed < /dev/tty

  if [[ "$typed" == "all" || "$typed" == "All" || "$typed" == "ALL" ]]; then
    backup_all_start
  fi
  if [[ "$typed" == "backup" || "$typed" == "a" || "$typed" == "A" ]]; then backup_start; fi
  if [[ "$typed" == "exit" || "$typed" == "Exit" || "$typed" == "EXIT" || "$typed" == "z" || "$typed" == "Z" ]]; then exit; fi

  current2=$(cat /var/mhs/state/pgvault.buildup | grep "\<$typed\>")
  if [ "$current2" != "" ]; then
    queued
    vaultbackup
  fi

  cat /var/mhs/state/pgvault.buildup > /tmp/appcheck.5
  cat /var/mhs/state/pgvault.apprecall >> /tmp/appcheck.5
  current1=$(cat /tmp/appcheck.5 | grep "\<$typed\>")
  if [ "$current1" == "" ]; then badinput && vaultbackup; fi

  buildup
}
##################################################### END - Backup Interface
#
##################################################### START - Restore Interface
vaultrestore() {
  notrun=$(cat /var/mhs/state/program.temp)
  buildup=$(cat /var/mhs/state/pgvault.output)

  if [ "$buildup" == "" ]; then buildup="NONE"; fi
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ Backup & Restore  ~ Data Recall  [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‚ App Data available to Restore

$notrun

ğŸ’¾ Apps Queued for Restore

$buildup

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[A] Restore
[Z] Exit
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
  read -p 'ğŸŒ Type APP for QUEUE | Type all to restore all apps | Press [ENTER]: ' typed < /dev/tty

  if [[ "$typed" == "all" || "$typed" == "All" || "$typed" == "ALL" ]]; then restore_all_start; fi

  if [[ "$typed" == "restore" || "$typed" == "a" || "$typed" == "A" ]]; then restore_start; fi

  if [[ "$typed" == "exit" || "$typed" == "Exit" || "$typed" == "EXIT" || "$typed" == "z" || "$typed" == "Z" ]]; then exit; fi

  current2=$(cat /var/mhs/state/pgvault.buildup | grep "\<$typed\>")
  if [ "$current2" != "" ]; then
    queued
    vaultrestore
  fi

  cat /var/mhs/state/pgvault.buildup > /tmp/appcheck.5
  cat /var/mhs/state/pgvault.apprecall >> /tmp/appcheck.5
  current1=$(cat /tmp/appcheck.5 | grep "\<$typed\>")
  if [ "$current1" == "" ]; then badinput && vaultrestore; fi

  buildup2
}
##################################################### START Primary Interface
primaryinterface() {
  initial2
  tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Backup & Restore Interface [ Protected APPS ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸŒµ Disk Used Space: $used of $capacity | $percentage Used Capacity

[1] Data Backup
[2] Data Restore
[3] Current Server ID  : $server_id
[4] Processing Location: $tarlocation

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
[Z] Exit
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
  read -p 'Type a Number | Press [ENTER]: ' typed < /dev/tty

  if [ "$typed" == "1" ]; then
    vaultbackup
    primaryinterface
  elif [ "$typed" == "2" ]; then
    serverprime
    vaultrestore
    primaryinterface
  elif [ "$typed" == "3" ]; then
    echo "0" > /var/mhs/state/server.id.stored
    bash /opt/mhs/lib/core/interface/serverid.sh
    primaryinterface
  elif [ "$typed" == "4" ]; then
    bash /opt/mhs/lib/backup-and-restore/location.sh
    primaryinterface
  elif [[ "$typed" == "Z" || "$typed" == "z" ]]; then
    exit
  else
    badinput
    primaryinterface
  fi
}
##################################################### END Primary Interface

restorecheck() {
  if [ "$restoreid" == "[NOT-SET]" ]; then
    tee <<- EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â›”ï¸  WARNING! - You Must Set Your Recovery ID First! Restarting Process!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF
    read -n 1 -s -r -p "Press [ANY] Key to Continue "
    echo
    primaryinterface
    exit
  fi
}
